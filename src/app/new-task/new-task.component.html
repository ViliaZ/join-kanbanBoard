<h3 *ngIf="!taskservice.editMode && (router.url.includes('backlog') || router.url.includes('board'))" class="headline">
  Add New Task</h3>
<h3 *ngIf="taskservice.editMode" class="headline">
  Edit Task</h3>

<form (ngSubmit)="onSubmit()" #myform="ngForm">
  <div class="title concave posRel">
    <input #title="ngModel" required placeholder="Title*" [(ngModel)]="formData.title" name="title">
    <app-validator [text]="'Title is required.'" *ngIf="title.errors?.['required'] && title.touched">
    </app-validator>
  </div>

  <div class="description concave">
    <textarea placeholder="Description" [(ngModel)]="formData.description" name="description">
      </textarea>
  </div>

  <!-- CHECKLIST ITEMS / TODOs -->
  <div class="todoItems">

    <div class="itemsHeadline posRel">
      <span>Checklist:</span>
      <div class="inputWrap posRel">
        <input #newTodo="ngModel" [(ngModel)]="newToDoItem" name="todos" type="text" placeholder=" + Add New Item "
          minlength="3">
        <app-validator *ngIf="newTodo.errors?.['minlength']" [text]="'Min. 3 characters'"></app-validator>
      </div>

      <!-- assign type to button, bc they are seen as submit form buttons-->
      <button type="button" class="btn-add" [disabled]="newTodo.errors?.['minlength'] || newToDoItem.length == 0"
        (click)="handleTodo('save')"></button>
      <button type="button" class="btn-clear" (click)="handleTodo('clear')"></button>
    </div>

    <!-- render unchecked items -->
    <div class="itemsContainer">
      <div *ngFor="let todo of formData.uncheckedTodos; index as i" class="row">
        <input *ngIf="!taskservice.editMode" disabled type="checkbox" id={{todo}} name={{todo}}>
        <input *ngIf="taskservice.editMode" (click)="markChecked(i, todo)" type="checkbox" id={{todo}} name={{todo}}>
        <label for={{todo}}>{{todo}}</label>
      </div>

      <!-- render checked items (EDITMODE only)-->
      <div *ngFor="let todo of formData.checkedTodos; index as i" class="row">
        <input *ngIf="taskservice.editMode" checked (click)="markUnchecked(i, todo)" type="checkbox" id={{todo}} name={{todo}}>
        <label for={{todo}}>{{todo}}</label>
      </div>

    </div>
  </div>

  <!-- DATE PICKER -->
  <mat-form-field class="datePicker example-full-width" appearance="fill">
    <input [(ngModel)]="formData.dueTo" name="dueto" placeholder="Choose a Due Date" class="concave borderRadiusAdjust"
      [min]="minDate" required matInput [matDatepicker]="picker">
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
  </mat-form-field>

  <div class="urgency">
    <label for="low" [class.activeButton]="activeUrgency == 'low'" (click)="setUrgencyButtonColor('low')">
      <img src="assets/img/lowprio.svg" alt="lowprio">
      Low
    </label>
    <input id="low" type="radio" value="low" name="urgency" [(ngModel)]="formData.urgency">

    <label for="medium" [class.activeButton]="activeUrgency == 'medium'" (click)="setUrgencyButtonColor('medium')">
      <img src="assets/img/mediumprio.svg" alt="highprio">
      Medium
    </label>
    <input id="medium" type="radio" value="medium" name="urgency" [(ngModel)]="formData.urgency">

    <label for="urgent" [class.activeButton]="activeUrgency == 'urgent'" (click)="setUrgencyButtonColor('urgent')">
      <img src="assets/img/highprio.svg" alt="highprio">
      Urgent
    </label>
    <input id="urgent" type="radio" value="urgent" name="urgency" [(ngModel)]="formData.urgency">
  </div>


  <div class="category">
    <select required (change)="handleCustomCategory('checkIfCustomRequest', $event)" #catSelect
      [(ngModel)]="formData.category" name="category">
      <option disabled value="">Choose a category*</option>
      <option value="Custom Category">Add Category</option>
      <option *ngFor="let category of db.userCategories$ | async" value={{category}}>{{ category }}</option> 
    </select>

    <div *ngIf="openCategoryPopUp" class="categoryPopUp posRel">
      <input [(ngModel)]="customCategory" name="customcategory" #inputCat="ngModel" minlength="3" maxlength="11"
        type="text" placeholder="Custom Category">
      <app-validator [text]="'Min. 3 / Max. 10 characters'"
        *ngIf="inputCat.errors?.['minlength'] || inputCat.errors?.['maxlength']">
      </app-validator>
      <div>

        <button #saveButton (click)="handleCustomCategory('save', $event, myform)"
          [disabled]="!inputCat.value || inputCat.errors?.['minlength']" class="default-btn">
          Save
        </button>
        <button (click)="handleCustomCategory('close')" class="default-btn" [class.secondary]="!saveButton.disabled">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <div class="user">
    <select [(ngModel)]="formData.responsibility" required name="responsibility">
      <option disabled>Select Responsibility*</option>
      <option *ngIf="authService.currentUser.displayName !== null" value={{authService.currentUser.displayName}}>
        {{authService.currentUser.displayName}}</option>
      <option *ngIf="authService.currentUser.displayName == null" value="Guest">Guest User</option>
      <option *ngFor="let user of authService.coUsers; index as i">{{user.displayName}}</option>
    </select>
  </div>


  <!-- Bottom ROW -->

  <div class="addTask">

    <div class="containerLeft">
      <span>Save to</span>
      <select class="selectSave" [(ngModel)]="formData.board" name="board">
        <option [selected] value="backlog">Backlog</option>
        <option *ngFor="let board of db.boards">{{ board.name }}</option>
      </select>
    </div>

    <!-- Buttons -->

    <div class="buttons">

      <button *ngIf="taskservice.taskPopupOpen" (click)="closeWithoutSave()" class="button btn-cancel default-btn">
        <svg class="btn-main" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300"
          zoomAndPan="magnify" viewBox="0 0 224.87999 225" height="300" preserveAspectRatio="xMidYMid meet"
          version="1.0">
          <defs>
            <clipPath id="id1">
              <path d="M 6.902344 10.21875 L 211 10.21875 L 211 214 L 6.902344 214 Z M 6.902344 10.21875 "
                clip-rule="nonzero" />
            </clipPath>
          </defs>
          <g clip-path="url(#id1)">
            <path fill="#000000"
              d="M 116.648438 111.972656 L 208.75 19.875 C 209.019531 19.613281 209.261719 19.328125 209.472656 19.019531 C 209.6875 18.710938 209.867188 18.382812 210.015625 18.039062 C 210.164062 17.695312 210.277344 17.335938 210.355469 16.96875 C 210.429688 16.601562 210.472656 16.230469 210.472656 15.855469 C 210.476562 15.480469 210.445312 15.109375 210.375 14.742188 C 210.300781 14.371094 210.195312 14.015625 210.054688 13.667969 C 209.910156 13.320312 209.738281 12.988281 209.527344 12.675781 C 209.320312 12.363281 209.085938 12.074219 208.820312 11.808594 C 208.554688 11.542969 208.265625 11.308594 207.953125 11.101562 C 207.640625 10.894531 207.308594 10.71875 206.960938 10.574219 C 206.613281 10.433594 206.257812 10.328125 205.886719 10.257812 C 205.519531 10.183594 205.148438 10.152344 204.773438 10.15625 C 204.398438 10.15625 204.027344 10.199219 203.660156 10.277344 C 203.292969 10.351562 202.933594 10.464844 202.589844 10.613281 C 202.246094 10.761719 201.917969 10.941406 201.609375 11.15625 C 201.300781 11.367188 201.015625 11.609375 200.753906 11.878906 L 108.65625 103.980469 L 16.554688 11.867188 C 16.292969 11.613281 16.007812 11.386719 15.699219 11.1875 C 15.390625 10.988281 15.066406 10.820312 14.722656 10.683594 C 14.382812 10.546875 14.03125 10.445312 13.671875 10.378906 C 13.3125 10.3125 12.945312 10.277344 12.578125 10.28125 C 12.210938 10.285156 11.847656 10.324219 11.488281 10.398438 C 11.128906 10.472656 10.78125 10.578125 10.441406 10.722656 C 10.105469 10.863281 9.78125 11.035156 9.476562 11.242188 C 9.171875 11.445312 8.890625 11.679688 8.632812 11.9375 C 8.371094 12.199219 8.140625 12.480469 7.933594 12.785156 C 7.730469 13.089844 7.558594 13.410156 7.414062 13.75 C 7.273438 14.085938 7.164062 14.4375 7.09375 14.796875 C 7.019531 15.15625 6.980469 15.519531 6.976562 15.886719 C 6.972656 16.253906 7.003906 16.617188 7.074219 16.976562 C 7.140625 17.339844 7.242188 17.6875 7.378906 18.03125 C 7.515625 18.371094 7.683594 18.695312 7.882812 19.003906 C 8.082031 19.3125 8.308594 19.597656 8.5625 19.863281 L 100.664062 111.972656 L 8.550781 204.074219 C 8.28125 204.332031 8.039062 204.617188 7.828125 204.925781 C 7.613281 205.234375 7.433594 205.5625 7.285156 205.90625 C 7.136719 206.253906 7.023438 206.609375 6.945312 206.976562 C 6.871094 207.34375 6.828125 207.714844 6.824219 208.089844 C 6.824219 208.464844 6.855469 208.835938 6.925781 209.207031 C 7 209.574219 7.105469 209.933594 7.246094 210.28125 C 7.390625 210.628906 7.5625 210.957031 7.773438 211.269531 C 7.980469 211.582031 8.214844 211.871094 8.480469 212.136719 C 8.746094 212.402344 9.035156 212.636719 9.347656 212.847656 C 9.660156 213.054688 9.992188 213.230469 10.339844 213.371094 C 10.6875 213.511719 11.042969 213.621094 11.414062 213.691406 C 11.78125 213.761719 12.152344 213.796875 12.527344 213.792969 C 12.902344 213.789062 13.273438 213.75 13.640625 213.671875 C 14.007812 213.59375 14.363281 213.480469 14.710938 213.332031 C 15.054688 213.183594 15.382812 213.003906 15.691406 212.792969 C 16 212.578125 16.285156 212.335938 16.546875 212.066406 L 108.65625 119.964844 L 200.753906 212.066406 C 201.019531 212.320312 201.304688 212.546875 201.613281 212.746094 C 201.921875 212.945312 202.246094 213.113281 202.585938 213.25 C 202.929688 213.386719 203.28125 213.488281 203.640625 213.554688 C 204 213.625 204.363281 213.65625 204.730469 213.652344 C 205.097656 213.648438 205.460938 213.613281 205.820312 213.539062 C 206.179688 213.464844 206.53125 213.355469 206.867188 213.214844 C 207.207031 213.070312 207.527344 212.898438 207.832031 212.695312 C 208.140625 212.488281 208.421875 212.257812 208.679688 211.996094 C 208.941406 211.738281 209.171875 211.457031 209.375 211.152344 C 209.582031 210.847656 209.753906 210.523438 209.894531 210.1875 C 210.039062 209.847656 210.144531 209.5 210.21875 209.140625 C 210.292969 208.78125 210.332031 208.417969 210.335938 208.050781 C 210.339844 207.683594 210.308594 207.320312 210.238281 206.957031 C 210.171875 206.597656 210.070312 206.246094 209.933594 205.90625 C 209.796875 205.5625 209.628906 205.238281 209.429688 204.929688 C 209.230469 204.625 209.003906 204.335938 208.75 204.074219 Z M 116.648438 111.972656 "
              fill-opacity="1" fill-rule="nonzero" />
          </g>
        </svg>

        <span>Cancel</span>
      </button>

      <button *ngIf="!taskservice.taskPopupOpen" (click)="closeWithoutSave()" class="btn-clear">
        <img src="assets/img/cancel.svg">
        <span>Clear</span>
      </button>

      <button type="submit" [disabled]="!myform.valid" class="button default-btn btn-save">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300"
          zoomAndPan="magnify" viewBox="0 0 224.87999 225" height="300" preserveAspectRatio="xMidYMid meet"
          version="1.0">
          <defs>
            <clipPath id="id1">
              <path d="M 32 0.0585938 L 224.761719 0.0585938 L 224.761719 224.9375 L 32 224.9375 Z M 32 0.0585938 "
                clip-rule="nonzero" />
            </clipPath>
            <clipPath id="id2">
              <path d="M 0 33 L 165 33 L 165 224.9375 L 0 224.9375 Z M 0 33 " clip-rule="nonzero" />
            </clipPath>
          </defs>
          <g clip-path="url(#id1)">
            <path stroke-linecap="round"
              transform="matrix(7.041474, -9.719039, 9.712435, 7.036691, 96.340707, 199.486408)" fill="none"
              stroke-linejoin="miter" d="M 0.500217 0.0000317118 L 16.738408 -0.0000674353 " stroke-width="1"
              stroke-opacity="1" stroke-miterlimit="4" />
          </g>
          <g clip-path="url(#id2)">
            <path stroke-linecap="round"
              transform="matrix(-7.952977, -8.962997, 8.971148, -7.960209, 100.563926, 202.451909)" fill="none"
              stroke-linejoin="miter" d="M 0.500187 -0.00000168597 L 11.32322 0.000123088 " stroke-width="1"
              stroke-opacity="1" stroke-miterlimit="4" />
          </g>
        </svg>
        <span>Save</span>
      </button>

    </div>
  </div>
</form>